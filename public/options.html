<!DOCTYPE html>
<html>
    <head>
        <title>Dropdowns and Checkboxes Example</title>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    </head>
    <body>
        <style>
            .grid-container {
                display: grid;
                grid-template-columns: repeat(4,410px );
                grid-template-rows: repeat(1, 750px);
                gap: 10px;
                background-color: #0a1610;

            }  
            .grid-item {
                background-color: #2acc80;
                border: 1px solid #35260a;
                padding: 20px;
                font-size: 18px;
                text-align: left;
            }
        </style>
        <div class="bg-success text-black">		
            <div class="d-flex flex-row bd-highlight mb-3">
                <div> <img src='assets/one.jpg'height='225' width='600'></div>
                <div> <img src='assets/three.png'height='225' width='650'></div>    
            </div>
            <p> 
            <h2 class="text-center" style="font-style: normal">Outdoor Power Sales & Solutions Estimate Repair Scheduler</h2>
            </p> 


                    <form id ="options-form">
                    <div class="d-flex bd-highlight ">
                        <div class="grid-item" ><h4>Select Options</h4>
                        <label for="brand">Choose your mower brand:</label>
                        <select id="brand" name="brand">
                            <option value="Toro">Toro</option>
                            <option value="Exmark">Exmark</option>
                            <option value="John Deere">John Deere</option>
                            <option value="Husqvarna">Husqvarna</option>
                            <option value="Other">Other</option>
                        </select>
                        <br>
                        <label for="equipment">Choose the type of equipment:</label>
                        <select id="equipment" name="equipment">
                            <option value="Walk Mower">Walk Mower</option>
                            <option value="Zero Turn">Zero Turn </option>
                            <option value="Stander">Stander</option>
                            <option value="Midsize">Midsize</option>
                            <option value="Other">Other</option>
                        </select>
                        <br>
                        <label class="into" for="checkboxes"><strong>Select your requests:</strong></label>
                        <br>
                        <input type="checkbox" id="checkbox1" name="requests" value="Tune up engine">
                        <label for="checkbox1">Tune up engine</label>
                        <br>
                        <input type="checkbox" id="checkbox2" name="requests" value="Change all filters and fluids">
                        <label for="checkbox2">Change all filters and fluids</label>
                        <br>
                        <input type="checkbox" id="checkbox3" name="requests" value="Sharpen blades">
                        <label for="checkbox3">Sharpen blades</label>										
                        <br>
                        <input type="checkbox" id="checkbox4" name="requests" value="Check belts">
                        <label for="checkbox4">Check Belts</label>
                        <br>
                        <input type="checkbox" id="checkbox5" name="requests" value="Repair flats">
                        <label for="checkbox5">Repair flats</label>
                        <br>
                        <input type="checkbox" id="checkbox6" name="requests" value="Check starter">
                        <label for="checkbox6">Check starter</label>
                        <br>
                        <label for="checkboxes"><strong>Symptoms:</strong></label>
                        <br>
                        <input type="checkbox" id="checkbox7" name="symptoms" value="Will not start">
                        <label for="checkbox7">Will not start</label>
                        <br>
                        <input type="checkbox" id="checkbox8" name="symptoms" value="Cuts uneven">
                        <label for="checkbox8">Cuts uneven</label>
                        <br>
                        <input type="checkbox" id="checkbox9" name="symptoms" value="Motion system not functioning">
                        <label for="checkbox9">Motion system not functioning</label>										
                        <br>
                        <input type="checkbox" id="checkbox10" name="symptoms" value="Smokes">
                        <label for="checkbox10">Smokes</label>
                        <br>
                        <input type="checkbox" id="checkbox11" name="symptoms" value="Blades will not turn">
                        <label for="checkbox11">Blades will not turn</label>
                        <br>
                        <label for="checkboxes">Proceed to Scheduler</label>
                        <br>
                </div>	
                <div class="grid-item">
                    <div >

                        <ul>    
                            <li><h3>Choose your mower brand.</h3> </li>
                            <br>	
                            <li><h3>Tell us the type of equipment that you have. </h3> </li>
                            <br>
                            <li><h3>Check off service requests that are needed.</h3> </li>	
                            <br><br><br><br><br><br><br>
                            <li><h3>Check off any symtoms that the unit is experiencing. </h3>   </li> 
                            <br> <br> <br> <br> <br> <br> 
                            <li><h3>Click submit to request type of service and schedule </h3>   </li> <br>
                        </ul>
                    </div>    
                </div>    
                <div class="grid-item"> 
                        <label for="year" ><strong>Choose the year</strong></label>
                        <br>
                        <select id="year" name="year">
                            <option value="2023">2023</option>
                            <option value="2024">2024</option>
                        </select>  
                        <br>   
                        <label for="month" ><strong>Choose the month</strong></label>
                        <br>
                        <select id="month" name="month">
                            <option value="January">January</option>
                            <option value="February">February</option>
                            <option value="March">March</option>
                            <option value="April">April</option>
                            <option value="May">May</option>
                            <option value="June">June</option>
                            <option value="July">July</option>
                            <option value="August">August</option>
                            <option value="September">September</option>
                            <option value="October">October</option>   
                            <option value="November">November</option>
                            <option value="December">December</option>
                        </select>  
                        <br>    

                        <label for="day"><strong>Choose the day</strong></label>
                        <br>
                        <select id="day" name="day">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                            <option value="9">9</option>
                            <option value="10">10</option>
                            <option value="11">11</option>
                            <option value="12">12</option>
                            <option value="13">13</option>
                            <option value="14">14</option>
                            <option value="15">15</option>
                            <option value="16">16</option>
                            <option value="17">17</option>
                            <option value="18">18</option>
                            <option value="19">19</option>
                            <option value="20">20</option>
                            <option value="21">21</option>
                            <option value="22">22</option>
                            <option value="23">23</option>
                            <option value="24">24</option>
                            <option value="25">25</option>
                            <option value="26">26</option>
                            <option value="27">27</option>
                            <option value="28">28</option>
                            <option value="29">29</option>
                            <option value="30">30</option>                    
                        </select>
                        <br> 
                        <label for="time" ><strong>Choose the time</strong></label>
                        <br>
                        <select id="time" name="time">
                            <option value="9:00 am">9:00 am</option>
                            <option value="10:00 am">10:00 am</option>
                            <option value="11:00 am">11:00 am</option>
                            <option value="12:00 pm">12:00 pm</option>
                            <option value="1:00 pm">1:00 pm</option>
                            <option value="2:00 pm">2:00 pm</option>   
                            <option value="3:00 pm">3:00 pm</option>
                        </select>  
                        <br>  

                        <label for="type" ><strong>Choose the type of appointment</strong></label>
                        <br>
                        <select id="type" name="type">
                            <option value="tech visit"> Onsite consultation</option>
                            <option value="pick up">Pick up my equipment</option>
                            <option value="mobile repair">Repair on site</option>                
                        </select>
                        <br> <br>
                        <input type="checkbox" id="checkbox15" name="checkbox15" value="Agree">
                        <br>
                        <label for="checkboxes"><strong>All fields have been entered and I agree to be contacted. </strong></label>
                        <label for="checkboxes"><strong>Schedule my appointment </strong></label>
                        <br>
                        <button id="submit-button" type="submit">Schedule</button>
                    </form>   


                </div>

            </div>
        </div>
        </div>	
        </div>
        </div>

        <script>

            function gatherFormData(form) {
                const formData = new FormData(form);
                const data = {};

                for(let pair of formData.entries()) {
                    if(pair[0] === "requests" || pair[0] === "symptoms") {
                        if(!data[pair[0]]) {
                            data[pair[0]] = [];
                        }
                        data[pair[0]].push(pair[1]);
                    } else if(pair[0] === "year" || pair[0] === "month" || pair[0] === "day" || pair[0] === "time" || pair[0] === "type") {
                        if(!data["schedule"]) {
                            data["schedule"] = {};
                        }
                        if (pair[0] === "year" || pair[0] === "month" || pair[0] === "day") {
                            if(!data["schedule"]["date"]) {
                                data["schedule"]["date"] = '';
                            }
                            // Ensure all parts of the date are two digits
                            let part = pair[1].length < 2 ? '0' + pair[1] : pair[1];
                            data["schedule"]["date"] += part + '-';
                        } else if (pair[0] === "type") {
                            data["schedule"]["description"] = pair[1];
                        } else if (pair[0] === "time") {
                            data["schedule"]["time"] = pair[1];
                        }
                    } else {
                        data[pair[0]] = pair[1];
                    }
                }

                // Remove trailing '-' from date
                if(data["schedule"] && data["schedule"]["date"]) {
                    data["schedule"]["date"] = data["schedule"]["date"].slice(0, -1);
                }

                return data;
            }
            document.getElementById('options-form').addEventListener('submit', (event) => {
                event.preventDefault();
                const data = gatherFormData(event.target);

                fetch('/options', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        return response.text(); // if response is okay, proceed
                    })
                    .then(data => {
                        console.log(data);
                        window.location.href = "/acceptance"; // redirect to acceptance page
                    })
                    .catch((error) => {
                        console.error('Error:', error);
                    });

            });
        </script>

    </body>
</html>

